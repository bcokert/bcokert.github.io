<!DOCTYPE html>
<html lang="default">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="BrandonOkert.com">
    <title>Building a Distributed Message Scheduler in PHP - BrandonOkert.com</title>
    <meta name="author" content="Brandon Okert">
    <meta name="description" content="BrandonOkert.com">
    
    
    <meta name="description" content="Guten Tag!
This weekend I build a little distributed message scheduler. I was recently motivated to learn PHP, and given a recent discussion at work, a message scheduler seemed the way to go. It fit t">
<meta property="og:type" content="blog">
<meta property="og:title" content="Building a Distributed Message Scheduler in PHP">
<meta property="og:url" content="http://brandonokert.com/2014/07/21/PHPMessageScheduler/index.html">
<meta property="og:site_name" content="BrandonOkert.com">
<meta property="og:description" content="Guten Tag!
This weekend I build a little distributed message scheduler. I was recently motivated to learn PHP, and given a recent discussion at work, a message scheduler seemed the way to go. It fit t">
<meta property="og:image" content="http://brandonokert.com/img/PHPMessageScheduler/MainInterface.png">
<meta property="og:image" content="http://brandonokert.com/img/PHPMessageScheduler/DispatcherInterface.png">
<meta property="og:image" content="http://brandonokert.com/img/PHPMessageScheduler/PschedArchitecture.jpg">
<meta property="og:updated_time" content="2016-01-31T16:06:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Building a Distributed Message Scheduler in PHP">
<meta name="twitter:description" content="Guten Tag!
This weekend I build a little distributed message scheduler. I was recently motivated to learn PHP, and given a recent discussion at work, a message scheduler seemed the way to go. It fit t">
<meta name="twitter:creator" content="@BrandonOkert">
    
    
    
        <meta property="og:image" content="http://www.gravatar.com/avatar/1796d3ceead403d9616a2093bc42ec18?s=640"/>
    
    
        <meta property="og:image" content="/2014/07/21/PHPMessageScheduler/MainInterface.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://brandonokert.com/2014/07/21/PHPMessageScheduler/MainInterface.png" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <link rel="stylesheet" href="/css-custom/style.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-66027344-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">BrandonOkert.com</a>
    </h1>
    
        
            <a  class="header-right-icon st-search-show-outputs"
                href="/#search">
        
                <i class="fa fa-lg fa-search"></i>
            </a>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    <div class="sidebar-profile">
        <a href="/#about">
            
            <img class="sidebar-profile-picture" src="http://www.gravatar.com/avatar/1796d3ceead403d9616a2093bc42ec18?s=90"/>
            
        </a>
        <span class="sidebar-profile-name">Brandon Okert</span>
    </div>
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/ 
                    ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-tags
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-archives
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/#about
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About me</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/bcokert" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://twitter.com/BrandonOkert" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://www.linkedin.com/pub/brandon-okert/32/aa6/850" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">Linked In</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">Building a Distributed Message Scheduler in PHP</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Mon Jul 21 2014 20:15:00 GMT-0700">
        Jul 21, 2014
    </time>
    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        
            <p>Guten Tag!</p>
<p>This weekend I build a little distributed message scheduler. I was recently motivated to learn PHP, and given a recent discussion at work, a message scheduler seemed the way to go. It fit the bill - not only would I be able to use php in a production-like setting, but I would also improve my fluency with distributed systems in general. It was also something I could get done in a reasonably short time - an important trait for an over-eager project starter like me.</p>
<h2 id="Pic_or_it_Didn’t_Happen">Pic or it Didn’t Happen</h2><p>This is what it looked like this morning:</p>
<p>The Main Server:</p>
<p><img src="/img/PHPMessageScheduler/MainInterface.png" alt="The Main Server Interface"></p>
<p>Scheduled Messages:</p>
<p><img src="/img/PHPMessageScheduler/DispatcherInterface.png" alt="The Dispatcher Server Interface"></p>
<p>Check out the <a href="https://github.com/bcokert/psched-main" target="_blank" rel="external">Main Server</a> and <a href="https://github.com/bcokert/psched-dispatcher" target="_blank" rel="external">Dispatcher</a> on Github.</p>
<h2 id="What_is_a_“Distributed_Message_Scheduler”?">What is a “Distributed Message Scheduler”?</h2><p>Sites like Facebook and Twitter capitalize on the concept of <em>posts</em>. A post is basically some text (including links to images, videos, etc.) with an associated poster and post time. A message scheduler in this context is just a system that posts messages at a certain time on behalf of a certain poster.</p>
<p>If you’re interested in learning php, or just want to build a reasonable complex system in a relatively short amount of time, a message scheduler is an excellent option. The distributed part is just a bonus that nets you extra scalabiltiy, without it becoming a “build Facebook” sized project.</p>
<p>The multi-server architecture is a little overkill for a personal project, but you can’t learn to drive a car if you only play with <a href="http://en.wikipedia.org/wiki/Hot_Wheels" target="_blank" rel="external">Hot Wheels</a>.</p>
<p>In the real world, it would be computationally infeasable to run both your social site <em>and</em> your message scheduler on the same machine. In a distributed system, your Main Server can take care of things that are already posted, and another server, a <em>Dispatcher</em>, can store all the posts to be posted down the road. In a really big system, you could have 1000 Main Servers, each with a pool of Dispatchers.</p>
<h2 id="How_Long_Did_This_Take?">How Long Did This Take?</h2><p>It took me three days, spending about 6 hours each day.</p>
<p>Day one I put together the two servers I’d be using - Installing Ubuntu, installing software, setting up a development environment, setting up <a href="http://en.wikipedia.org/wiki/Apache_HTTP_Server" target="_blank" rel="external">Apache</a>, etc. I also coded most of the Main Server’s interface.</p>
<p>Day two I finished off the interface, then went to work setting up and testing <a href="http://en.wikipedia.org/wiki/MySQL" target="_blank" rel="external">mysql databases</a>. The main database stores posted posts, and the dispatcher’s database stores scheduled posts. I also wrote the various php endpoints that allow posting and scheduling of messages.</p>
<p>Day three was setting up the Dispatcher to automatically post scheduled posts at the right time. Php on the command line was used here, with a little help from <a href="http://en.wikipedia.org/wiki/Cron" target="_blank" rel="external">Cron</a>. Then it was all testing and polishing, until 18 hours later I had a working system.</p>
<h2 id="Gimme_Architecture">Gimme Architecture</h2><p>The main server provides two services to the external world: postMessage.php and scheduleMessage.php. The Dispatcher Server provides two corresponding services. Internally, scheduleMessage.php on the Main Server just posts data to the local Dispatcher, and similarly the Dispatcher just forwards data to postMessage.php on the Main Server. Also external is a basic interface for the Main Server, which provides a scheduling form, and a feed viewer.</p>
<p>On the Dispatcher, cron runs every minute, checking the scheduled messages for posts that need to go out. Any it finds are deleted from the Dispatcher’s database, then forwarded to the Main Server. The Dispatcher also has a basic interface that allows checking on the scheduled messages.</p>
<p>This image has all the nitty gritty details, and you can find more on <a href="https://github.com/bcokert" target="_blank" rel="external">Github</a>.<br><img src="/img/PHPMessageScheduler/PschedArchitecture.jpg" alt="System Architecture"></p>

        
        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/message-scheduler/">message-scheduler</a> <a class="tag tag--primary tag--small t-link" href="/tags/micro-service/">micro-service</a> <a class="tag tag--primary tag--small t-link" href="/tags/php/">php</a> <a class="tag tag--primary tag--small t-link" href="/tags/project/">project</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/08/04/TestingInReact/"  data-tooltip="Testing in React">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/07/13/FirstPost/" data-tooltip="First Post!">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Brandon Okert. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/08/04/TestingInReact/"  data-tooltip="Testing in React">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/07/13/FirstPost/" data-tooltip="First Post!">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="1">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://brandonokert.com/2014/07/21/PHPMessageScheduler/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="http://www.gravatar.com/avatar/1796d3ceead403d9616a2093bc42ec18?s=110"/>
        
            <h4 id="about-card-name">Brandon Okert</h4>
        
            <h5 id="about-card-bio"><p>Husband, Software Engineer, Web Developer, Coffee Geek, Chess Dabbler, Runner, Strategy Gamer, Dog Owner, Cat Lover.<br><img src="/img/about/about-me-profile.jpg" alt=""> <img src="/img/about/sarah3.png" alt=""> <img src="/img/about/storm-n-me.jpg" alt=""> <img src="/img/about/storm-giving-a-speech.jpg" alt=""><br><img src="/img/about/brandonsarah1.jpg" alt=""> <img src="/img/about/brandonsarah2.jpg" alt=""> <img src="/img/about/sarah1.jpg" alt=""> <img src="/img/about/sarah2.jpg" alt=""></p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Hootsuite Media Inc.</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Vancouver, BC
            </h5>
        
    </div>
</div>
        <div id="cover" style="background-image:url('/assets/images/covercloud.png');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<script src="/js-custom/sequenced-image.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'brandonokert';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>



</html>
