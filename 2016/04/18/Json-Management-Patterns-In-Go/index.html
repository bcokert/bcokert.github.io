<!DOCTYPE html>
<html lang="default">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="BrandonOkert.com">
    <title>Json Management Patterns In Go - BrandonOkert.com</title>
    <meta name="author" content="Brandon Okert">
    <meta name="description" content="BrandonOkert.com">
    
    
    <meta name="description" content="Managing Json in Go is not a trivial problem. There are many examples out there of how to decode a simple json document into a struct, but few that answer the questions that inevitably come up:

How d">
<meta property="og:type" content="blog">
<meta property="og:title" content="Json Management Patterns In Go">
<meta property="og:url" content="http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/index.html">
<meta property="og:site_name" content="BrandonOkert.com">
<meta property="og:description" content="Managing Json in Go is not a trivial problem. There are many examples out there of how to decode a simple json document into a struct, but few that answer the questions that inevitably come up:

How d">
<meta property="og:image" content="http://brandonokert.com/img/Json-Management-Patterns-In-Go/primer.png">
<meta property="og:updated_time" content="2016-04-18T18:51:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Json Management Patterns In Go">
<meta name="twitter:description" content="Managing Json in Go is not a trivial problem. There are many examples out there of how to decode a simple json document into a struct, but few that answer the questions that inevitably come up:

How d">
<meta name="twitter:creator" content="@BrandonOkert">
    
    
    
        <meta property="og:image" content="http://www.gravatar.com/avatar/1796d3ceead403d9616a2093bc42ec18?s=640"/>
    
    
        <meta property="og:image" content="/2016/04/18/Json-Management-Patterns-In-Go/thumbnail.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/thumbnail.png" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <link rel="stylesheet" href="/css-custom/style.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-66027344-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">BrandonOkert.com</a>
    </h1>
    
        
            <a  class="header-right-icon st-search-show-outputs"
                href="/#search">
        
                <i class="fa fa-lg fa-search"></i>
            </a>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    <div class="sidebar-profile">
        <a href="/#about">
            
            <img class="sidebar-profile-picture" src="http://www.gravatar.com/avatar/1796d3ceead403d9616a2093bc42ec18?s=90"/>
            
        </a>
        <span class="sidebar-profile-name">Brandon Okert</span>
    </div>
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/ 
                    ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-tags
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-archives
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/#about
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About me</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/bcokert" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://twitter.com/BrandonOkert" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://www.linkedin.com/pub/brandon-okert/32/aa6/850" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">Linked In</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">Json Management Patterns In Go</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Mon Apr 18 2016 11:30:00 GMT-0700">
        Apr 18, 2016
    </time>
    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        
            <p>Managing Json in Go is not a trivial problem. There are many examples out there of how to decode a simple json document into a struct, but few that answer the questions that inevitably come up:</p>
<ul>
<li>How do I provide defaults for fields?</li>
<li>How do I make a field optional?</li>
<li>How do I avoid using defaults for certain fields (eg: a user id)?</li>
<li>How do I prevent pointer maintenance issues down the road?</li>
<li>How do I validate all this?</li>
</ul>
<p>Below I’ve outlined several <a href="#Patterns">Patterns</a> that provide ideomatic, easy to use, and easy to test solutions that provide these <a href="#Features">Features</a>. Different <a href="#Patterns">Patterns</a> achieve different <a href="#Features">Features</a> - thus you can pick the solution that is most relevant to your application.</p>
<p>Keep reading to learn about the individual <a href="#Features">Features</a> we’ll be covering, or skip right to the <a href="#Patterns">Patterns</a> to learn them as they come up.</p>
<h1 id="Primer">Primer</h1><p><img src="/img/Json-Management-Patterns-In-Go/primer.png" alt="Primer"><br>A Model is a struct that has meaning in our application - a User, a Scene, a Parcel. Models can be Marshaled into json. Inversely, json can be Unmarshaled into new Models. In all but the most trivial applications, we need to Validate incoming json, which in go is usually done after Unmarshaling.</p>
<p>When Unmarshaling json into a Model, we utilize struct tags to denote the field name. When Marshaling, we use the same tags, as well as a new one to signal whether it should be omitted when empty:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Model <span class="keyword">struct</span> &#123;</span><br><span class="line">  UserId <span class="typename">uint</span> <span class="string">`json:"user_id"`</span></span><br><span class="line">  Address <span class="typename">string</span> <span class="string">`json:"address,omitempty"`</span> <span class="comment">// if empty, don't encode it at all</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Our desired <a href="#Features">Features</a> dictate how we structure our Models, and how we Marshal, Unmarshal, and Validate them.</p>
<h1 id="Features">Features</h1><p>Below I’ve described each feature in detail. Each Pattern also provides links to these Features.</p>
<h2 id="Default_Fields">Default Fields</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProductCount <span class="typename">uint</span> <span class="comment">// required, but zero is a safe default</span></span><br></pre></td></tr></table></figure>
<p>This is a field that is required, but if not provided we’re ok with the default value provided by Go.</p>
<p>Defaults in Go come for free - if a field is not present in the source json, a default value (0, “”, nil, etc.) will be used. This can be very convenient, but it only works in cases where the default value makes sense (you wouldn’t want to provide a default name for a user).</p>
<h2 id="Custom_Default_Fields">Custom Default Fields</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FavoriteColor <span class="typename">string</span> <span class="comment">// a default is ok, but we don't want the empty string</span></span><br></pre></td></tr></table></figure>
<p>This is a field where you want a default value, but not the zero value.</p>
<p>The process is a little more involved than basic default values since we need an in-between step, but we’ll see how supporting <a href="#Required_Non_Default_Fields">Required Non Default Fields</a> can give us <a href="#Custom_Default_Fields">Custom Default Fields</a> for free.</p>
<h2 id="Optional_Fields">Optional Fields</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Address *<span class="typename">string</span> <span class="comment">// not required, but we still want to validate it if it's there</span></span><br></pre></td></tr></table></figure>
<p>This is a field that may or may not be available. If present, we want to validate it, but if not present, we don’t want to fail validation.</p>
<p>Github popularized the <a href="https://willnorris.com/2014/05/go-rest-apis-and-pointers" target="_blank" rel="external">method of using pointers for this purpose</a>, as their default value is nil and there is no such thing as a pointer in json. It adds a bit of overhead, but really there’s no way around this - sometimes it’s there, sometimes it’s not. Validation is more tedious if you’re not using <a href="#Easy_Validation">Easy Validation</a>, as you have to handle both the case where it’s present and the case where it’s not. For fields that you don’t want defaults for, but still want them to be required, use <a href="#Required_Non_Default_Fields">Required Non Default Fields</a> instead.</p>
<h2 id="Required_Non_Default_Fields">Required Non Default Fields</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserId *<span class="typename">uint</span> <span class="comment">// it's required, but providing a default doesn't make sense</span></span><br></pre></td></tr></table></figure>
<p>This is a field that is required, but we don’t want to provide a default for. Validating it is similar to <a href="#Optional_Fields">Optional Fields</a>, except the case where it is missing is now invalid.</p>
<p>We can re-use the pointer method from <a href="#Optional_Fields">Optional Fields</a>, and just change the validation. However, this leaves us with a pointer that will always have a value, which adds unwanted maintenance. We can avoid this completely with <a href="#Dereferenced_Required_Fields">Dereferenced Required Fields</a>.</p>
<h2 id="Dereferenced_Required_Fields">Dereferenced Required Fields</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">  UserId *<span class="typename">uint</span> <span class="comment">// this is a Required Non-Default Field, so it needs a pointer</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Model <span class="keyword">struct</span> &#123;</span><br><span class="line">  UserId <span class="typename">uint</span> <span class="comment">// but it's not optional, so we don't want the pointer in the model</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is a meta-feature, wherein we’ve used a pointer in our struct, but really that pointer should never be nil. By de-referencing it, we save ourselves maintenance and testability headaches down the road.</p>
<p>The idea is to separate the model from the json request that creates it, using intermediate representations. As we’ll see, this can make other <a href="#Features">Features</a> like <a href="Custom_Default_Fields">Custom Default Fields</a> trivial to implement, and it can make partial updates (where any subset of fields may be present) easier to manage down the road.</p>
<h2 id="Easy_Validation">Easy Validation</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserId *<span class="typename">uint</span> <span class="string">`validate:"nonzero"`</span></span><br><span class="line">Age Uint <span class="string">`validate:"min=18"`</span></span><br></pre></td></tr></table></figure>
<p>Easy Validation lets us verify that our models are in a legal state after Unmarshaling, without having to manually verify every field and every case.</p>
<p>In its simplest form, validation can be done manually, thus making it easy to port to any solution. The ideomatic <a href="https://github.com/go-validator/validator" target="_blank" rel="external">Go Validator</a> is an alternative to manual validation with many desirable qualities. However, there are a few tricks to making it support <a href="#Optional_Fields">Optional Fields</a>, and <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>. We can simplify it further via the intermediate representations from <a href="#Dereferenced_Required_Fields">Dereferenced Required Fields</a>. </p>
<h1 id="Patterns">Patterns</h1><p>Each Pattern provides a subset of the above <a href="#Features">Features</a>. The Patterns increase in complexity as you go, so you should pick the earliest one that satisfies all your requirements. Most of the more complex Patterns focus on doing more work up front so that maintenance down the road is much easier.</p>
<h2 id="Pattern_1">Pattern 1</h2><p>Features: <a href="$Default_Fields">Default Fields</a>, <a href="#Easy_Validation">Easy Validation</a></p>
<p>This is our base case pattern with very little maintenance or setup involved. If your api is simple, this is the way to go.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// model</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name <span class="typename">string</span>    <span class="string">`json:"name"    validate:"nonzero"`</span></span><br><span class="line">     Age <span class="typename">uint</span>       <span class="string">`json:"age"     validate:"min=1"`</span></span><br><span class="line">     Address <span class="typename">string</span> <span class="string">`json:"address" validate:"nonzero"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmarshalling</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line"><span class="keyword">if</span> err := json.NewDecoder(jsonByteSlice).Decode(&amp;user); err != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// marshalling</span></span><br><span class="line"><span class="keyword">if</span> jsonByteSlice, err := json.Marshal(object); err != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// validation</span></span><br><span class="line"><span class="keyword">if</span> errs := validator.Validate(user); errs != <span class="constant">nil</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Pattern_2">Pattern 2</h2><p>Features: <a href="$Default_Fields">Default Fields</a>, <a href="#Optional_Fields">Optional Fields</a>, <a href="#Required_Non_Default_Fields">Required Non Default Fields</a></p>
<p>If you just want <a href="#Optional_Fields">Optional Fields</a> and <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>, and don’t mind manually validating and dealing with some maintenance overhead, use this pattern.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// model</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name          *<span class="typename">string</span> <span class="string">`json:"name"`</span>              <span class="comment">// required, but no defaults</span></span><br><span class="line">     Age           *<span class="typename">uint</span>   <span class="string">`json:"age,omitempty"`</span>     <span class="comment">// optional</span></span><br><span class="line">     Address       *<span class="typename">string</span> <span class="string">`json:"address,omitempty"`</span> <span class="comment">// optional</span></span><br><span class="line">     FavoriteColor <span class="typename">string</span>  <span class="string">`json:"favoriteColor"`</span>     <span class="comment">// required, uses defaults</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmarshalling</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line"><span class="keyword">if</span> err := json.NewDecoder(jsonByteSlice).Decode(&amp;user); err != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// marshalling</span></span><br><span class="line"><span class="keyword">if</span> jsonByteSlice, err := json.Marshal(object); err != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// validation</span></span><br><span class="line"><span class="keyword">func</span> Validate(user User) &#123;</span><br><span class="line">     <span class="comment">// default - validate value</span></span><br><span class="line">     <span class="comment">// optional - if non nil, validate value</span></span><br><span class="line">     <span class="comment">// required non default - validate not nil, then validate value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Pattern_3">Pattern 3</h2><p>Features: <a href="$Default_Fields">Default Fields</a>, <a href="#Optional_Fields">Optional Fields</a>, <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>, <a href="#Easy_Validation">Easy Validation</a></p>
<p>You can make Pattern 2 support <a href="#Easy_Validation">Easy Validation</a> by using multiple validators, plus a custom validator for edge cases. If <a href="https://github.com/go-validator/validator" target="_blank" rel="external">Go Validator</a> encounters a pointer, and it is nil, it ignores it, otherwise it dereferences and validates it. This supports <a href="#Optional_Fields">Optional Fields</a>. If you combine it with the nonzero validator, you can support <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserId *<span class="typename">uint</span> <span class="string">`validate:"nonzero,min=100"`</span></span><br></pre></td></tr></table></figure></p>
<p>The UserId is a pointer, but it has the nonzero validator, so it can’t be nil. It also has the min validator, which only checks the value if it is a non-nil pointer. Combined, they provide <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>.</p>
<p>There is a minor catch, in that we can no longer use the nonzero validator on our <a href="#Optional_Fields">Optional Fields</a> and <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>. This is easily mitigated in most cases by using the min=1 validator instead, but in some cases, like integers, we cannot prevent a zero value. If this is important, you can use a <a href="https://godoc.org/gopkg.in/validator.v2#hdr-Custom_validation_functions" target="_blank" rel="external">Custom Validator</a>.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// model</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name          *<span class="typename">string</span> <span class="string">`json:"name"              validate:"nonzero,min=1"`</span> <span class="comment">// required, but no defaults</span></span><br><span class="line">     Age           *<span class="typename">uint</span>   <span class="string">`json:"age,omitempty"     validate:"min=1"`</span>         <span class="comment">// optional</span></span><br><span class="line">     Address       *<span class="typename">string</span> <span class="string">`json:"address,omitempty" validate:"min=1"`</span>         <span class="comment">// optional</span></span><br><span class="line">     FavoriteColor <span class="typename">string</span>  <span class="string">`json:"favoriteColor"`</span>                              <span class="comment">// required, uses defaults</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmarshalling</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line"><span class="keyword">if</span> err := json.NewDecoder(jsonByteSlice).Decode(&amp;user); err != <span class="constant">nil</span> &#123;..&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// marshalling</span></span><br><span class="line"><span class="keyword">if</span> jsonByteSlice, err := json.Marshal(object); err != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// validation</span></span><br><span class="line"><span class="keyword">if</span> errs := validator.Validate(user); errs != <span class="constant">nil</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Pattern_4">Pattern 4</h2><p>Features: <a href="$Default_Fields">Default Fields</a>, <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>, <a href="#Easy_Validation">Easy Validation</a>, <a href="#Custom_Default_Fields">Custom Default Fields</a>, <a href="#Dereferenced_Required_Fields">Dereferenced Required Fields</a></p>
<p>This Pattern provides all of the <a href="#Features">Features</a> we’ve discussed, and lets us simplify the validation from <a href="#Pattern_3">Pattern 3</a>. It’s a good general purpose solution that avoids some long term maintenance, but is probably overkill for very simple projects.</p>
<p>The idea is to create an intermediate representation, one for each interface to the model. This separates the model from how it is built. For example, you might have a User model, a PostUserRequest, and a PutUserRequest, each with different validation. The business logic only cares about the Model, so it can be helpful to decouple said Model from how it is constructed or modified.</p>
<p>This separation of validation lets us achieve <a href="#Custom_Default_Fields">Custom Default Fields</a> and <a href="#Dereferenced_Required_Fields">Dereferenced Required Fields</a> in a natural way, by performing them during the translation from intermediate representation to Model.</p>
<p>It also removes the catch from Pattern 3 for <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>, since we validate the pointer separately from the value.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// post request</span></span><br><span class="line"><span class="keyword">type</span> UserPostRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name               *<span class="typename">string</span> <span class="string">`json:"name" validate:"nonzero"`</span> <span class="comment">// required, but no defaults</span></span><br><span class="line">     Age                *<span class="typename">uint</span>   <span class="string">`json:"age"`</span>                     <span class="comment">// optional</span></span><br><span class="line">     Address            *<span class="typename">string</span> <span class="string">`json:"address"`</span>                 <span class="comment">// optional</span></span><br><span class="line">     FavoriteInstrument <span class="typename">string</span>  <span class="string">`json:"favoriteInstrument"`</span>      <span class="comment">// required, uses defaults</span></span><br><span class="line">     FavoriteColor      *<span class="typename">string</span> <span class="string">`json:"favoriteColor"`</span>           <span class="comment">// required, uses custom defaults</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// model</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name               <span class="typename">string</span>  <span class="string">`json:"name" validate:"nonzero"`</span>            <span class="comment">// required</span></span><br><span class="line">     Age                *<span class="typename">uint</span>   <span class="string">`json:"age,omitempty" validate:"min=1"`</span>     <span class="comment">// optional</span></span><br><span class="line">     Address            *<span class="typename">string</span> <span class="string">`json:"address,omitempty" validate:"min=1"`</span> <span class="comment">// optional</span></span><br><span class="line">     FavoriteInstrument <span class="typename">string</span>  <span class="string">`json:"favoriteInstrument"`</span>                 <span class="comment">// required</span></span><br><span class="line">     FavoriteColor      <span class="typename">string</span>  <span class="string">`json:"favoriteColor" validate:"nonzero"`</span>   <span class="comment">// required</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmarshalling</span></span><br><span class="line"><span class="keyword">var</span> postRequest UserPostRequest</span><br><span class="line"><span class="keyword">if</span> err := json.NewDecoder(jsonByteSlice).Decode(&amp;postRequest); err != <span class="constant">nil</span> &#123;..&#125;</span><br><span class="line"><span class="keyword">if</span> errs := validator.Validate(postRequest); errs != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line">user.Name = *postRequest.Name</span><br><span class="line">user.Age = postRequest.Age</span><br><span class="line">user.Address = postRequest.Address</span><br><span class="line">user.FavoriteInstrument = postRequest.FavoriteInstrument</span><br><span class="line">user.FavoriteColor = <span class="string">"blue"</span></span><br><span class="line"><span class="keyword">if</span> postRequest.FavoriteColor != <span class="constant">nil</span> &#123;</span><br><span class="line">  user.FavoriteColor = *postRequest.FavoriteColor</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> errs := validator.Validate(user); errs != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// marshalling</span></span><br><span class="line"><span class="keyword">if</span> jsonByteSlice, err := marshal(object); err != <span class="constant">nil</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// validation</span></span><br><span class="line"><span class="keyword">if</span> errs := validator.Validate(user); errs != <span class="constant">nil</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>Though it looks like unnecessary duplication, this format lets you separate the PostRequest from the actual Model, which can be very useful. Notice how we also did all the validation the Model, except for <a href="#Required_Non_Default_Fields">Required Non Default Fields</a>.</p>
<h1 id="Conclusion">Conclusion</h1><p>I’ve covered 4 different <a href="#Patterns">Patterns</a> for json management, each more comprehensive than the last. Hopefully I’ve also given you a good feeling for what <a href="#Features">Features</a> might be needed in a json api, and how you can approach providing them.</p>
<p>I’m currently battle testing Pattern 4 in a project of mine - <a href="https://github.com/bcokert/render-cloud" target="_blank" rel="external">Render Cloud</a>.</p>
<p>I hope this overview is useful to you. I learned a lot by coming up with the <a href="#Patterns">Patterns</a> and investigating them, and I hope this will expedite the process for your own projects.</p>

        
        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/go/">go</a> <a class="tag tag--primary tag--small t-link" href="/tags/golang/">golang</a> <a class="tag tag--primary tag--small t-link" href="/tags/json/">json</a> <a class="tag tag--primary tag--small t-link" href="/tags/patterns/">patterns</a> <a class="tag tag--primary tag--small t-link" href="/tags/rest/">rest</a> <a class="tag tag--primary tag--small t-link" href="/tags/validation/">validation</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/03/07/Scaling-with-Docker-Part-2/" data-tooltip="Scaling with Docker Part 2">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Brandon Okert. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/03/07/Scaling-with-Docker-Part-2/" data-tooltip="Scaling with Docker Part 2">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="1">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://brandonokert.com/2016/04/18/Json-Management-Patterns-In-Go/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="http://www.gravatar.com/avatar/1796d3ceead403d9616a2093bc42ec18?s=110"/>
        
            <h4 id="about-card-name">Brandon Okert</h4>
        
            <h5 id="about-card-bio"><p>Husband, Software Engineer, Web Developer, Coffee Geek, Chess Dabbler, Runner, Strategy Gamer, Dog Owner, Cat Lover.<br><img src="/img/about/about-me-profile.jpg" alt=""> <img src="/img/about/sarah3.png" alt=""> <img src="/img/about/storm-n-me.jpg" alt=""> <img src="/img/about/storm-giving-a-speech.jpg" alt=""><br><img src="/img/about/brandonsarah1.jpg" alt=""> <img src="/img/about/brandonsarah2.jpg" alt=""> <img src="/img/about/sarah1.jpg" alt=""> <img src="/img/about/sarah2.jpg" alt=""></p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Hootsuite Media Inc.</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Vancouver, BC
            </h5>
        
    </div>
</div>
        <div id="cover" style="background-image:url('/assets/images/covercloud.png');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<script src="/js-custom/sequenced-image.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'brandonokert';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>



</html>
